# 作业评分系统实现计划

- [x] 1. 实现核心统一函数





  - 创建 `find_teacher_signature_cell` 函数用于定位"教师（签字）"单元格
  - 创建 `extract_grade_and_comment_from_cell` 函数用于提取评分、评价和签字文本
  - 创建 `write_to_teacher_signature_cell` 函数用于写入评分、评价和签字文本
  - _架构约束: 统一函数使用规范_

- [x] 1.1 为核心统一函数编写单元测试






  - 测试 `find_teacher_signature_cell` 的定位功能
  - 测试 `extract_grade_and_comment_from_cell` 的提取功能
  - 测试 `write_to_teacher_signature_cell` 的写入功能
  - _架构约束: 统一函数使用规范_

- [x] 2. 实现作业类型判断逻辑
  - 创建 `is_lab_report_file` 函数实现多级判断逻辑
  - 实现数据库查询优先级（作业批次 > 课程类型）
  - 实现路径解析和关键词匹配逻辑
  - _需求: 2.1.1, 2.1.2, 2.1.3, 2.1.4, 2.1.5, 2.1.6, 2.1.7, 2.1.8, 2.1.9_

- [x] 2.2 实现作业类型标签显示功能
  - 在HTML模板中引入homework-type-labels.js文件
  - 确保JavaScript文件在jstree初始化之前加载
  - 在目录树加载完成后调用addHomeworkTypeLabels函数
  - 实现类型标签的点击修改功能
  - _需求: 2.3.1, 2.3.2, 2.3.3, 2.3.4, 2.3.5, 2.3.6, 2.3.7_

- [x] 2.3 实现作业类型API端点

  - 创建 `get_homework_type_api` 视图函数获取作业类型
  - 创建 `update_homework_type_api` 视图函数更新作业类型
  - 实现作业批次自动创建逻辑
  - 添加URL路由配置
  - _需求: 2.2.1, 2.2.2, 2.2.3, 2.2.4, 2.2.5_

- [x] 3. 实现实验报告评分写入功能

  - 创建 `write_grade_to_lab_report` 函数
  - 集成核心统一函数（定位、提取、写入）
  - 实现格式错误检测和降级处理
  - 实现锁定机制（格式错误时自动设置D评分和锁定标记）
  - _需求: 4.4, 4.5, 4.6, 11.1, 11.2, 11.3, 11.4, 11.5_

- [x] 4. 实现统一的文件写入接口


  - 创建 `write_grade_and_comment_to_file` 函数
  - 实现锁定检查逻辑
  - 集成作业类型判断
  - 实现实验报告和普通作业的分支处理
  - _需求: 4.3, 4.7, 11.6, 11.7_

- [x] 5. 重构现有功能使用统一接口






  - 更新 `add_grade_to_file` 视图函数（手动评分）
  - 更新 `save_teacher_comment` 视图函数（教师评价）
  - 更新 `get_teacher_comment` 视图函数（获取评价）
  - 更新 `remove_grade` 视图函数（撤销评分）
  - 更新 `ai_score_view` 视图函数（AI评分）
  - 验证所有功能的评分方式切换和已有评分识别
  - _需求: 4.1-4.9, 5.1-5.8, 6.1-6.10, 15.1-15.7, 16.1-16.7_
  - _架构约束: 统一函数使用规范_

- [x] 5.1 为重构功能编写集成测试







  - 测试手动评分流程（新建和更新）
  - 测试教师评价功能
  - 测试获取评价功能
  - 测试撤销评分功能
  - 测试AI评分流程
  - 测试评分方式切换
  - _需求: 4.1-4.9, 5.1-5.8, 6.1-6.10, 15.1-15.7, 16.1-16.7_

- [x] 16. 实现批量评分功能
  - 创建批量评分页面和视图
  - 实现文件列表显示
  - 实现统一评分等级应用
  - 实现进度条和状态显示
  - 实现错误处理和统计信息
  - _需求: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6_

- [x] 17. 实现批量AI评分功能
  - 创建批量AI评分页面和视图
  - 实现文件依次处理逻辑
  - 实现速率限制（每秒最多2个请求）
  - 实现进度显示和结果摘要
  - _需求: 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7_

- [x] 18. 实现文件浏览和内容显示
  - 创建文件树视图
  - 实现Word文档转HTML显示
  - 实现文本文件显示
  - 实现Excel文件转HTML表格显示
  - 实现错误提示
  - _需求: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6_


- [x] 6. 实现文件导航功能




  - 创建上一个/下一个按钮
  - 实现文件位置显示（如"3/10"）
  - 实现按钮禁用逻辑
  - 保持评分方式状态
  - _需求: 9.1, 9.2, 9.3, 9.4, 9.5, 9.6_

- [x] 7. 实现仓库管理功能
  - 创建仓库模型和视图
  - 实现仓库创建（本地和Git类型）
  - 实现仓库列表显示
  - 实现Git仓库同步功能
  - 实现所有仓库管理视图函数（management/add/update/delete/sync）
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 8. 实现课程和作业管理
  - 创建课程和作业批次模型
  - 实现课程类型自动检测
  - 实现作业批次类型配置
  - 实现课程和作业批次修改功能
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5, 2.2.1, 2.2.2, 2.2.3, 2.2.4, 2.2.5_

- [x] 9. 实现评分类型配置
  - 创建评分类型配置模型
  - 实现评分类型记录和自动应用
  - 实现评分类型锁定机制
  - _需求: 10.1, 10.2, 10.3, 10.4, 10.5_

- [x] 10. 实现格式错误锁定机制的UI支持





  - 实现锁定标记检测（后端已实现）
  - 实现锁定文件的界面提示
  - 实现锁定文件的评分按钮禁用
  - _需求: 11.6, 11.7, 11.8, 11.9_

- [x] 11. 实现多租户支持
  - 配置租户模型和中间件
  - 实现租户数据隔离
  - 实现租户管理功能
  - _需求: 12.1, 12.2, 12.3, 12.4, 12.5_

- [x] 12. 实现权限控制
  - 配置认证和授权中间件
  - 实现登录重定向
  - 实现角色权限检查
  - 实现路径遍历攻击防护
  - _需求: 13.1, 13.2, 13.3, 13.4, 13.5_

- [x] 13. 实现缓存和性能优化
  - 实现目录文件数量缓存
  - 实现目录树懒加载
  - 优化文件内容加载性能
  - _需求: 14.1, 14.2, 14.3, 14.4, 14.5_

- [x] 14. 实现错误处理和日志
  - 配置日志系统
  - 实现友好的错误提示
  - 实现详细的错误日志记录
  - 实现操作日志记录
  - _需求: 18.1, 18.2, 18.3, 18.4, 18.5_

- [x] 15. 编写端到端测试







  - 测试完整的评分流程
  - 测试格式错误处理流程
  - 测试批量操作流程
  - _需求: 所有需求_
