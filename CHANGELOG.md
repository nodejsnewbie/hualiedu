# 更新日志

本文档记录作业评分系统的所有重要更改。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [未发布]

### 计划中
- 移动端适配
- 更多AI模型支持
- 实时协作评分
- 评分数据分析和可视化

## [1.0.0] - 2024-11-30

### 新增

#### 课程和班级管理
- 课程创建功能，支持四种课程类型（理论课/实验课/实践课/混合课）
- 班级管理功能，支持多班级
- 课程类型自动识别和手动配置

#### 仓库管理
- Git仓库方式支持
  - 远程仓库配置
  - 分支管理
  - SSH/HTTPS认证
  - 连接验证
- 文件系统方式支持
  - 自动空间分配
  - 目录名自动生成和重名处理
  - 目录结构验证
- 双模式同时支持

#### 学生作业上传
- 文件系统方式支持学生直接上传
- 文件格式验证（Word、Excel、PDF、文本）
- 文件大小限制（50MB）
- 版本管理（覆盖上传保留历史）
- 上传进度显示

#### 智能评分系统
- 三种评分方式
  - 字母等级（A/B/C/D/E）
  - 文字等级（优秀/良好/中等/及格/不及格）
  - 百分制（0-100分）
- 评分方式锁定机制
- 实验报告特殊处理
  - 自动定位"教师（签字）"单元格
  - 强制评价验证
  - 格式错误自动降级
- 普通作业评分
  - 文档末尾添加评分
- 评分撤销功能

#### AI辅助评分
- 基于火山引擎Ark SDK
- 自动生成评分和评价
- 实验报告自动生成评价
- 速率限制保护（每秒2个请求）
- 批量AI评分支持

#### 评价功能
- 评价缓存
  - 浏览器本地存储
  - 每2秒自动保存
  - 意外关闭恢复
  - 7天自动清理
- 评价模板
  - 个人常用评价（Top 5）
  - 系统推荐评价
  - 基于使用频率排序
  - 自动统计和更新
  - 快速填充功能

#### 批量操作
- 批量手动评分
  - 统一评分等级或分数
  - 实时进度显示
  - 错误不中断流程
  - 成功失败统计
- 批量AI评分
  - 自动速率限制
  - 实时进度显示
  - 失败自动跳过
  - 详细结果摘要

#### 文件浏览和导航
- 树形目录结构
- 文件内容预览（Word、Excel、文本）
- 文件间快速切换
- 当前位置显示
- 作业类型标签显示

#### 格式验证和锁定
- 实验报告格式自动验证
- 格式错误自动处理
  - 评分改为D
  - 添加锁定标记
  - 按普通作业方式写入
- 锁定文件禁止修改
- 红色警告提示

#### 多租户架构
- 租户数据完全隔离
- 租户级配置管理
- 基于角色的权限控制
- 自动租户识别

#### 学期管理
- 自动学期检测
- 基于模板自动创建
- 学期状态管理
- 时间线可视化

#### 性能优化
- 目录文件数量缓存
- 评价模板查询缓存（Redis）
- 课程和班级列表缓存
- 数据库查询优化
  - 添加索引
  - select_related和prefetch_related
- 懒加载目录树

#### 管理功能
- Django Admin增强（django-jazzmin）
- 自定义管理命令
  - scan_courses - 扫描课程目录
  - import_homeworks - 导入作业数据
  - semester_management - 学期管理
  - create_templates - 创建学期模板
  - update_course_types - 更新课程类型
  - clear_cache - 清除缓存

### 技术实现

#### 后端
- Django 4.2.20
- Python 3.13
- PostgreSQL/SQLite
- Redis缓存
- GitPython 3.1.45
- python-docx 1.2.0
- openpyxl 3.1.5
- pandas 2.3.3
- volcengine 1.0.206

#### 前端
- Bootstrap 5
- jQuery
- jsTree（目录树）
- 原生JavaScript（评价缓存）

#### 开发工具
- black（代码格式化）
- isort（导入排序）
- flake8（代码检查）
- pre-commit（提交前检查）

#### 测试
- Django TestCase
- 单元测试
- 集成测试
- 端到端测试
- 属性测试（Property-Based Testing）

### 文档

#### 核心文档
- 需求文档（EARS格式，17个主需求）
- 设计文档（完整系统架构）
- 实现计划（任务清单）

#### 用户文档
- 用户手册（完整使用指南）
- 快速参考（核心概念）
- 批量登分指南

#### 开发文档
- 开发指南（环境配置）
- API文档（完整接口说明）
- 部署指南（开发/生产/Docker）
- 项目结构（代码组织）
- 团队协作指南

#### 技术文档
- 缓存优化实现
- 数据库优化
- 评价缓存实现
- 已知问题和修复

### 测试覆盖

- 数据模型测试
- 服务层测试
- 视图层测试
- API接口测试
- 集成测试
- 端到端测试
- 性能测试
- 缓存测试

### 已知限制

- 单个文件最大50MB
- 批量操作最多500个文件
- AI评分速率限制（每秒2个请求）
- 仅支持特定文件格式

## [0.9.0] - 2024-11-15

### 新增
- 基础评分功能
- 文件浏览功能
- 简单的课程管理

### 修复
- 文件路径安全验证
- 多租户数据隔离

## [0.8.0] - 2024-11-01

### 新增
- 项目初始化
- 基础架构搭建
- 多租户支持

---

## 版本说明

### 版本号格式
- 主版本号：重大架构变更或不兼容的API修改
- 次版本号：新功能添加，向后兼容
- 修订号：bug修复和小改进

### 更新类型
- **新增**：新功能
- **修改**：现有功能的变更
- **弃用**：即将移除的功能
- **移除**：已移除的功能
- **修复**：bug修复
- **安全**：安全相关的修复

## 贡献

欢迎提交问题和功能建议！请查看 [贡献指南](docs/TEAM_COLLABORATION.md)。

## 许可证

本项目采用 MIT 许可证。
