# .gitignore 最佳实践说明

## 概述
本文档说明项目的 `.gitignore` 配置和最佳实践。

## 不应提交的文件类型

### 1. 敏感信息
- **环境变量**: `.env`, `.env.local`, `.env.production`
- **SSH 密钥**: `id_rsa*`, `id_ed25519*`, `*.pem`, `*.key`
- **数据库**: `db.sqlite3`, `*.sql`, `*.dump`
- **密码和令牌**: 任何包含密码、API 密钥的文件

### 2. 生成的文件
- **Python 缓存**: `__pycache__/`, `*.pyc`, `*.pyo`
- **静态文件收集**: `/staticfiles/` (由 `collectstatic` 生成)
- **日志文件**: `*.log`, `logs/*.log`
- **测试覆盖率**: `.coverage`, `htmlcov/`

### 3. 用户上传的文件
- **媒体文件**: `/media/` (用户上传的内容)
- **作业文件**: 学生提交的作业

### 4. 临时文件
- **备份**: `*_backup*`, `*.backup`, `*.bak`
- **临时**: `*_temp*`, `*_tmp*`, `*.tmp`
- **旧文件**: `*_old*`

### 5. 开发环境
- **虚拟环境**: `.venv/`, `venv/`, `env/`
- **IDE 配置**: `.vscode/`, `.idea/`
- **OS 文件**: `.DS_Store`, `Thumbs.db`

### 6. 测试数据
- **测试目录**: `testteacher*/`, `test_repo*/`
- **Hypothesis 缓存**: `.hypothesis/`

## 应该提交的文件

### 1. 源代码
- 所有 `.py` 文件
- 模板文件 (`.html`)
- 静态资源源文件 (`static/`, `grading/static/`)

### 2. 配置文件
- `pyproject.toml` - 项目配置
- `uv.lock` - 依赖锁定
- `.python-version` - Python 版本锁定
- `requirements.txt` - 依赖列表
- `.env.example` - 环境变量示例

### 3. 文档
- `README.md`
- `docs/` 目录下的文档

### 4. 数据库迁移
- `grading/migrations/*.py` - Django 迁移文件

## 检查命令

### 检查是否有不该提交的文件
```bash
# 检查是否有 .pyc 文件被跟踪
git ls-files | grep "\.pyc$"

# 检查是否有日志文件被跟踪
git ls-files | grep "\.log$"

# 检查是否有备份文件被跟踪
git ls-files | grep -E "(backup|\.bak)"

# 检查是否有敏感文件被跟踪
git ls-files | grep -E "(ssh_keys|\.pem|\.key|id_rsa|id_ed25519)"
```

### 从 Git 中移除已跟踪的文件
```bash
# 移除单个文件
git rm --cached <file>

# 移除目录
git rm --cached -r <directory>

# 移除所有匹配的文件
git ls-files | grep "pattern" | xargs git rm --cached
```

## 安全提示

1. **永远不要提交**:
   - SSH 私钥
   - 数据库密码
   - API 密钥和令牌
   - 用户数据

2. **如果不小心提交了敏感信息**:
   - 立即从 Git 历史中移除（使用 `git filter-branch` 或 `BFG Repo-Cleaner`）
   - 更改所有暴露的密码和密钥
   - 通知团队成员

3. **定期检查**:
   - 定期运行上述检查命令
   - 在 PR 审查时检查是否有敏感文件

## 参考资源

- [GitHub .gitignore 模板](https://github.com/github/gitignore)
- [Django 部署检查清单](https://docs.djangoproject.com/en/stable/howto/deployment/checklist/)
