# 作业评分系统 - 用户手册

## 目录
- [系统概述](#系统概述)
- [术语说明](#术语说明)
- [快速入门](#快速入门)
- [课程和班级管理](#课程和班级管理)
- [作业管理](#作业管理)
- [学生作业提交指南](#学生作业提交指南)
- [作业上传](#作业上传)
- [评分操作](#评分操作)
- [批量操作](#批量操作)
- [常见问题](#常见问题)

## 系统概述

作业评分系统是一个功能完整的教育平台，支持：
- 课程和班级管理
- 两种作业提交方式（Git仓库和文件上传）
- 三种评分方式（字母、文字、百分制）
- AI辅助评分
- 批量评分操作
- 评价缓存和模板

## 快速参考

### 教师快速开始

1. **创建课程和班级**
   - 进入"课程管理" → 创建课程 → 创建班级

2. **配置作业提交方式**
   - 进入"作业管理" → 创建作业配置
   - 选择Git仓库或文件上传方式

3. **开始评分**
   - 选择作业配置 → 浏览文件 → 评分

### 学生快速开始

1. **登录系统**
   - 使用学生账号登录

2. **提交作业**
   - 进入"作业提交" → 选择课程 → 上传文件

3. **查看提交状态**
   - 在作业列表中查看"已提交"标记

### 关键概念

| 概念 | 说明 |
|------|------|
| 作业配置 | 教师为课程和班级设置的作业提交方式 |
| 提交方式 | Git仓库（远程直接访问）或文件上传（学生自助） |
| 作业次数 | 作业的批次，如"第一次作业"、"第二次作业" |
| 远程直接访问 | Git方式无需同步，直接从远程仓库读取 |

## 术语说明

为了让系统更易于理解和使用，我们使用了以下教育领域的术语：

| 术语 | 说明 | 示例 |
|------|------|------|
| **作业管理** | 教师配置和管理学生作业提交方式的功能 | 创建作业配置、查看作业列表 |
| **作业配置** | 一个作业的提交方式设置，包括课程、班级、提交方式等信息 | "数据结构-计算机1班-Git仓库" |
| **提交方式** | 学生提交作业的方式，支持Git仓库和文件上传两种 | Git仓库、文件上传 |
| **作业次数** | 作业的批次或序号 | 第一次作业、第二次作业 |
| **课程** | 教学课程 | 数据结构、算法设计 |
| **班级** | 上课的班级 | 计算机1班、计算机2班 |
| **作业目录** | 存储学生作业文件的目录结构 | `数据结构/计算机1班/第一次作业/` |

**重要变更**：
- 原"仓库管理"现更名为"作业管理"
- 原"仓库"现称为"作业配置"
- 原"仓库方式"现称为"提交方式"
- 系统界面已全面更新为新术语
- 不再需要手动"同步"操作，系统自动从远程获取最新内容

## 快速入门

### 1. 登录系统

访问系统URL并使用您的账号登录。

### 2. 创建课程

1. 进入"课程管理"页面
2. 点击"创建课程"按钮
3. 填写课程信息：
   - 课程名称（如：数据结构）
   - 课程类型（理论课/实验课/实践课/混合课）
   - 课程描述（可选）
4. 点击"保存"

### 3. 创建班级

1. 选择已创建的课程
2. 点击"创建班级"按钮
3. 填写班级信息：
   - 班级名称（如：计算机1班）
   - 学生人数
4. 点击"保存"

### 4. 配置作业提交方式

选择适合您的作业提交方式：

**Git仓库方式**（适合已有Git仓库）：
1. 进入"作业管理"页面
2. 点击"创建作业配置"
3. 选择"Git仓库"提交方式
4. 填写Git信息：
   - 仓库URL
   - 分支名称
   - 认证信息（用户名/密码或Token）
5. 点击"保存"

**文件上传方式**（适合学生直接上传）：
1. 进入"作业管理"页面
2. 点击"创建作业配置"
3. 选择"文件上传"提交方式
4. 填写课程名称和班级名称
5. 系统自动创建目录结构
6. 学生可通过系统上传作业

### 5. 开始评分

1. 选择作业配置和课程
2. 浏览作业文件
3. 点击文件查看内容
4. 选择评分方式并打分
5. 添加评价（实验报告必填）

## 课程和班级管理

### 课程类型说明

| 类型 | 说明 | 默认作业类型 |
|------|------|-------------|
| 理论课 | 纯理论课程 | 普通作业 |
| 实验课 | 纯实验课程 | 实验报告 |
| 实践课 | 实践类课程 | 实验报告 |
| 混合课 | 理论+实验 | 实验报告 |

### 创建课程

**步骤**：
1. 导航到"课程管理" → "创建课程"
2. 填写必填信息：
   - 课程名称：清晰描述课程内容
   - 课程类型：根据实际情况选择
3. 填写可选信息：
   - 课程描述：详细说明课程内容和要求
4. 点击"保存"

**注意事项**：
- 课程名称应该唯一且有意义
- 课程类型影响默认的作业类型判断
- 创建后可以在管理后台修改

### 创建班级

**步骤**：
1. 选择课程
2. 点击"创建班级"
3. 填写班级信息：
   - 班级名称：如"计算机1班"
   - 学生人数：用于统计
4. 点击"保存"

**注意事项**：
- 一个课程可以有多个班级
- 班级名称在同一课程下应该唯一

## 作业管理

### 作业管理概述

作业管理是系统的核心功能，让教师能够轻松配置和管理学生作业的提交方式，无需了解复杂的技术细节。

**核心理念**：
- **简单易用**：使用教育领域的术语，隐藏技术细节
- **灵活配置**：支持Git仓库和文件上传两种方式
- **自动化**：系统自动创建目录结构，自动从远程获取内容
- **独立管理**：每个课程和班级可以独立配置

**系统支持两种提交方式**：

1. **Git仓库方式**：适合已有Git仓库的场景
   - 直接从远程仓库读取，无需本地同步
   - 实时查看最新内容
   - 自动缓存提高性能

2. **文件上传方式**：适合学生直接通过系统上传作业
   - 学生自助上传文件
   - 自动创建目录结构
   - 支持作业次数管理

### 创建作业配置

**步骤**：
1. 进入"作业管理"页面
2. 点击"创建作业配置"按钮
3. 填写基本信息：
   - 作业名称：如"数据结构作业"
   - 选择课程
   - 选择班级
4. 选择提交方式（Git仓库或文件上传）
5. 根据选择的方式填写相应配置
6. 点击"保存"

### Git仓库方式

**适用场景**：
- 已有Git仓库管理学生作业
- 学生通过Git提交作业
- 需要版本控制

**配置步骤**：
1. 选择"Git仓库"提交方式
2. 填写Git仓库信息：
   - **仓库URL**：支持HTTPS和SSH协议
     - HTTPS示例：`https://github.com/username/repo.git`
     - SSH示例：`git@github.com:username/repo.git`
   - **分支名称**：通常是`main`或`master`
   - **用户名**：Git账号用户名（HTTPS方式需要）
   - **密码/Token**：Git密码或Personal Access Token
3. 点击"保存"

**重要特性**：
- **远程直接访问**：系统直接从远程仓库读取作业，无需同步到本地
- **实时查看**：查看的始终是远程仓库的最新内容
- **无需同步操作**：不再需要点击"同步"按钮
- **自动缓存**：系统自动缓存远程数据以提高性能

**目录结构要求**：
```
仓库根目录/
  ├── 课程名/
  │   └── 班级名/
  │       ├── 第一次作业/
  │       │   ├── 张三-作业1.docx
  │       │   └── 李四-作业1.pdf
  │       └── 第二次作业/
  │           ├── 张三-作业2.docx
  │           └── 李四-作业2.pdf
```

**常见问题**：
- **连接失败**：检查URL格式和网络连接
- **认证失败**：确认用户名和密码/Token正确
- **找不到分支**：确认分支名称拼写正确
- **访问慢**：首次访问会较慢，后续会使用缓存

### 文件上传方式

**适用场景**：
- 学生需要通过系统上传作业
- 不使用Git版本控制
- 简单直接的文件管理

**配置步骤**：
1. 选择"文件上传"提交方式
2. 系统自动根据课程和班级生成目录结构
3. 点击"保存"

**特点**：
- **自动目录结构**：系统自动创建`<课程名>/<班级名>/`目录
- **学生自助上传**：学生可直接通过系统上传文件
- **作业次数管理**：学生可创建新的作业次数目录
- **文件覆盖**：重复上传会覆盖旧文件

**目录结构**：
```
<课程名>/
  └── <班级名>/
      ├── 第一次作业/
      │   ├── 张三-作业1.docx
      │   └── 李四-作业1.pdf
      └── 第二次作业/
          ├── 张三-作业2.docx
          └── 李四-作业2.pdf
```

**文件命名规则**：
- 文件名必须包含学生姓名
- 如果文件名不包含姓名，系统会自动添加
- 示例：`张三-数据结构作业1.docx`

### 查看和管理作业配置

**查看作业列表**：
1. 进入"作业管理"页面
2. 查看所有作业配置
3. 可按课程和班级筛选

**作业列表显示信息**：
- 作业名称
- 提交方式（Git仓库/文件上传）
- 关联课程
- 关联班级
- 创建时间

**编辑作业配置**：
1. 在作业列表中点击作业名称
2. 修改配置信息
3. 点击"保存"

**注意**：编辑作业配置不会影响已提交的学生作业数据。

**删除作业配置**：
1. 在作业列表中点击"删除"按钮
2. 确认删除操作
3. 系统会提示对已提交作业的影响

**注意**：删除作业配置会保留已提交的学生作业数据。

### 班级隔离

系统为不同班级维护独立的作业目录：

**示例**：
```
数据结构/
  ├── 计算机1班/
  │   ├── 第一次作业/
  │   └── 第二次作业/
  └── 计算机2班/
      ├── 第一次作业/
      └── 第二次作业/
```

**特点**：
- 同一课程的不同班级有独立目录
- 互不干扰
- 便于管理

## 学生作业提交指南

### 学生提交作业流程

**前提条件**：
- 教师已配置文件上传方式的作业
- 学生已登录系统

**完整提交步骤**：

#### 1. 进入作业提交页面
- 登录系统后，点击导航菜单中的"作业提交"或"学生提交"
- 系统会自动识别您的学生身份

#### 2. 选择课程
- 系统显示您所在班级的所有课程
- 只显示配置了文件上传方式的课程
- 点击要提交作业的课程名称

#### 3. 查看作业次数列表
- 系统显示该课程下的所有作业次数目录
- 每个作业次数会显示：
  - 作业名称（如"第一次作业"）
  - 提交状态（已提交/未提交）
  - 已提交的文件名（如果已提交）

#### 4. 创建新作业次数（如需要）
- 如果需要提交新的作业次数，点击"创建新作业"按钮
- 系统会自动：
  - 根据现有作业次数生成下一个序号
  - 例如：已有"第一次作业"和"第二次作业"，则创建"第三次作业"
  - 遵循统一的命名规范
- 创建成功后，新目录立即显示在列表中

#### 5. 上传作业文件
- 选择要提交的作业次数（点击作业名称或"上传"按钮）
- 点击"选择文件"按钮，从您的电脑选择作业文件
- 确认文件选择正确
- 点击"上传"按钮开始上传
- 等待上传完成（显示进度条）

#### 6. 确认提交成功
- 系统显示"上传成功"提示信息
- 作业列表中该作业显示"已提交"标记
- 显示已提交的文件名
- 可以查看提交时间

### 支持的文件格式

系统支持以下文件格式：
- **Word文档**：.docx, .doc
- **PDF文件**：.pdf
- **压缩文件**：.zip, .rar
- **文本文件**：.txt
- **图片文件**：.jpg, .png

### 文件命名要求

**重要**：文件名必须包含您的姓名，以便教师识别。

**正确示例**：
- `张三-数据结构作业1.docx`
- `李四-第一次作业.pdf`
- `王五作业.zip`

**系统处理**：
- 如果文件名不包含您的姓名，系统会自动添加
- 例如：`作业1.docx` → `张三-作业1.docx`

### 文件大小限制

- 单个文件最大：**10MB**
- 如果文件过大，建议压缩后上传

### 重复提交

**覆盖规则**：
- 重复上传同一作业次数的文件会覆盖旧文件
- 系统保留最新上传的文件
- 建议在截止日期前确认提交正确

**查看已提交作业**：
- 作业次数列表会显示"已提交"标记
- 显示已提交的文件名

### 学生常见问题

**Q1: 如何知道我需要提交哪些作业？**
- A: 查看作业次数列表，未提交的作业会有明显标识
- 教师通常会在课堂上或通过其他方式告知作业要求

**Q2: 可以修改已提交的作业吗？**
- A: 可以，重新上传文件即可覆盖旧文件
- 系统保留最新上传的文件
- 建议在截止日期前确认提交正确

**Q3: 上传失败怎么办？**
- A: 请按以下步骤检查：
  1. 确认文件格式是否支持（docx, pdf, zip, txt, jpg, png）
  2. 确认文件大小不超过10MB
  3. 检查网络连接是否正常
  4. 检查文件名是否包含特殊字符
  5. 尝试刷新页面后重新上传

**Q4: 如何确认作业已成功提交？**
- A: 提交成功的标志：
  - 页面显示"上传成功"提示信息
  - 作业列表中显示"已提交"标记
  - 可以看到已提交的文件名
  - 可以看到提交时间

**Q5: 可以提交多个文件吗？**
- A: 每次只能上传一个文件
- 如需提交多个文件，建议：
  - 将所有文件压缩成一个zip文件
  - 或者将多个文档合并成一个PDF文件

**Q6: 文件名有什么要求？**
- A: 文件名必须包含您的姓名
- 如果文件名不包含姓名，系统会自动添加
- 建议使用格式：`姓名-作业名称.扩展名`
- 例如：`张三-数据结构作业1.docx`

**Q7: 为什么看不到某些课程？**
- A: 可能的原因：
  - 教师还未配置该课程的作业提交方式
  - 该课程配置的是Git仓库方式（不通过系统上传）
  - 您不在该课程的班级中

**Q8: 上传后可以删除作业吗？**
- A: 不能直接删除，但可以：
  - 重新上传新文件覆盖旧文件
  - 联系教师处理

**Q9: 截止日期后还能提交吗？**
- A: 这取决于教师的设置
- 建议在截止日期前完成提交
- 如有特殊情况，请联系教师

**Q10: 如何查看教师的评分和评价？**
- A: 评分功能目前主要面向教师
- 查看评分结果请咨询教师或查看其他通知渠道

## 作业上传

### 学生上传作业

**前提条件**：
- 仓库配置为文件系统方式
- 学生已登录系统

**上传步骤**：
1. 进入"作业上传"页面
2. 选择课程和班级
3. 选择作业批次
4. 点击"选择文件"
5. 选择作业文件
6. 点击"上传"

**支持的文件格式**：
- Word文档：.docx, .doc
- Excel表格：.xlsx, .xls
- 文本文件：.txt
- PDF文件：.pdf

**文件大小限制**：
- 单个文件最大50MB

**版本管理**：
- 重复上传会覆盖旧文件
- 系统保留历史版本记录
- 可查看上传历史

### 教师导入作业

**使用管理命令导入**：
```bash
conda run -n py313 python manage.py import_homeworks <仓库路径> <课程名称>
```

**功能**：
- 扫描指定目录
- 自动识别作业批次
- 创建作业记录
- 更新数据库

## 评分操作

### 评分方式

系统支持三种评分方式：

#### 1. 字母等级
- **等级**：A, B, C, D, E
- **适用**：大多数课程
- **特点**：简单直观

#### 2. 文字等级
- **等级**：优秀、良好、中等、及格、不及格
- **适用**：中文环境
- **特点**：符合中文习惯

#### 3. 百分制
- **范围**：0-100分
- **适用**：需要精确评分
- **特点**：精确量化

**评分方式锁定**：
- 首次评分后，班级的评分方式会被锁定
- 确保同一班级评分方式一致
- 如需更改，需在管理后台操作

### 手动评分

**步骤**：
1. 在目录树中选择作业文件
2. 查看文件内容
3. 点击"评分"按钮
4. 选择评分方式
5. 选择或输入评分
6. 添加评价（实验报告必填）
7. 点击"保存"

**实验报告特殊要求**：
- 必须添加评价内容
- 评价不能为空
- 系统会自动验证

**评分写入位置**：
- **实验报告**：写入"教师（签字）"单元格
- **普通作业**：写入文档末尾

### AI辅助评分

**功能**：
- 自动分析作业内容
- 生成评分建议
- 生成评价内容

**使用步骤**：
1. 选择作业文件
2. 点击"AI评分"按钮
3. 等待AI分析（约5-10秒）
4. 查看AI建议的评分和评价
5. 可以修改后再保存
6. 点击"确认"保存

**注意事项**：
- AI评分仅供参考
- 教师可以修改AI建议
- 实验报告会自动生成评价
- 速率限制：每秒最多2个请求

### 评价功能

#### 评价缓存
**功能**：
- 自动保存正在输入的评价
- 防止意外关闭丢失内容
- 每2秒自动保存一次

**使用**：
- 无需手动操作
- 重新打开对话框时自动恢复
- 保存成功后自动清除缓存

#### 评价模板
**功能**：
- 显示常用评价
- 快速填充评价内容
- 基于使用频率排序

**模板类型**：
1. **个人常用评价**：您使用最多的5个评价
2. **系统推荐评价**：全局使用最多的评价

**使用方法**：
1. 打开评价对话框
2. 查看推荐的评价模板
3. 点击模板快速填充
4. 可以编辑后再保存

**模板更新**：
- 每次保存评价时自动统计
- 使用次数自动累加
- 排序自动更新

### 撤销评分

**步骤**：
1. 选择已评分的文件
2. 点击"撤销评分"按钮
3. 确认操作
4. 评分和评价被清除

**注意事项**：
- 撤销后无法恢复
- 格式错误锁定的文件无法撤销
- 需要重新评分

## 批量操作

### 批量评分

**适用场景**：
- 多个学生作业评分相同
- 快速完成评分工作

**步骤**：
1. 点击"批量评分"按钮
2. 选择作业批次目录
3. 选择评分方式
4. 输入统一评分
5. 点击"开始批量评分"
6. 查看进度和结果

**特点**：
- 显示实时进度
- 单个失败不影响整体
- 显示成功和失败统计

### 批量AI评分

**适用场景**：
- 大量作业需要评分
- 希望AI辅助提高效率

**步骤**：
1. 点击"批量AI评分"按钮
2. 选择作业批次目录
3. 点击"开始批量AI评分"
4. 等待处理完成
5. 查看结果摘要

**特点**：
- 自动速率限制（每秒2个请求）
- 显示实时进度
- 失败文件自动跳过
- 显示详细结果

**注意事项**：
- 处理时间较长
- 需要稳定的网络连接
- 建议分批处理大量文件

## 文件导航

### 快速切换文件

**功能**：
- 在同一目录的文件间快速切换
- 显示当前位置（如：3/10）
- 保持评分方式选择

**操作**：
- 点击"上一个"按钮：查看前一个文件
- 点击"下一个"按钮：查看后一个文件
- 第一个文件时"上一个"按钮禁用
- 最后一个文件时"下一个"按钮禁用

### 目录树导航

**功能**：
- 树形结构显示所有目录和文件
- 展开/折叠目录
- 快速定位文件

**操作**：
- 点击目录名展开/折叠
- 点击文件名查看内容
- 使用搜索功能快速查找

## 格式错误处理

### 实验报告格式验证

**验证规则**：
- 实验报告必须包含"教师（签字）"单元格
- 单元格位置和格式必须正确

**格式错误处理**：
1. 系统自动检测格式
2. 如果缺少"教师（签字）"单元格：
   - 评分自动改为D
   - 评价自动设置为"【格式错误-已锁定】请按要求的格式写实验报告，此评分不可修改"
   - 按普通作业方式写入
   - 文件被锁定

**锁定效果**：
- 显示红色警告提示
- 禁用所有评分按钮
- 禁用评价功能
- 无法修改评分

**解锁方法**：
- 学生重新提交正确格式的作业
- 或手动编辑文档删除锁定标记

## 常见问题

### Q1: 如何选择提交方式？

**A**: 根据您的实际情况选择：
- 如果学生已经使用Git提交作业 → 选择Git仓库方式
- 如果学生需要通过系统上传 → 选择文件上传方式
- 两种方式可以为不同课程/班级分别配置

### Q2: 实验课程下可以有普通作业吗？

**A**: 可以。作业批次类型优先于课程类型。您可以为每个作业批次单独设置类型。

### Q3: 如何修改已有作业的类型？

**A**: 
1. 在管理后台找到Homework模型
2. 找到对应的作业批次
3. 修改homework_type字段
4. 保存

### Q4: 评分方式可以更改吗？

**A**: 首次评分后，班级的评分方式会被锁定。如需更改：
1. 进入管理后台
2. 找到GradeTypeConfig模型
3. 修改或删除对应记录

### Q5: AI评分不准确怎么办？

**A**: AI评分仅供参考，您可以：
- 修改AI建议的评分
- 修改AI生成的评价
- 完全不使用AI，手动评分

### Q6: 批量评分失败怎么办？

**A**: 
1. 查看错误信息
2. 检查文件格式是否正确
3. 确认文件没有被锁定
4. 单独处理失败的文件

### Q7: 如何查看评分历史？

**A**: 
1. 在管理后台查看Submission模型
2. 可以看到所有评分记录
3. 包括评分时间、评分内容等

### Q8: 文件上传失败怎么办？

**A**: 检查：
- 文件格式是否支持（docx, pdf, zip, txt, jpg, png）
- 文件大小是否超过10MB
- 网络连接是否正常
- 文件名是否包含特殊字符

### Q9: 评价缓存在哪里？

**A**: 评价缓存保存在浏览器的LocalStorage中：
- 每个文件独立缓存
- 7天后自动清理
- 清除浏览器数据会删除缓存

### Q10: 如何导出评分结果？

**A**: 
1. 使用批量登分功能
2. 在管理后台导出数据
3. 使用自定义管理命令

### Q11: Git仓库方式还需要同步吗？

**A**: 不需要。系统现在直接从远程仓库读取内容，无需手动同步操作。

### Q12: 为什么看不到"同步"按钮了？

**A**: 新版本采用远程直接访问架构，系统自动从远程仓库获取最新内容，不再需要同步操作。

### Q13: 如何为不同班级创建独立的作业配置？

**A**: 
1. 进入"作业管理"页面
2. 为每个班级分别创建作业配置
3. 选择相同的课程，不同的班级
4. 系统会自动为每个班级创建独立的目录

### Q14: 学生如何知道要提交哪个作业次数？

**A**: 
- 教师应该在课堂上或通过其他方式告知学生
- 学生可以在作业提交页面看到所有作业次数
- 如果是新作业，学生可以点击"创建新作业"按钮

### Q15: 作业配置可以删除吗？

**A**: 可以删除，但会保留已提交的学生作业数据。删除前系统会提示确认。

## 技术支持

如果遇到问题：
1. 查看[已知问题](./KNOWN_ISSUES.md)
2. 查看[API文档](./API.md)
3. 查看[设计文档](../.kiro/specs/homework-grading-system/design.md)
4. 联系系统管理员

## 相关文档

- [快速参考](./SUMMARY.md) - 核心概念速查
- [批量登分指南](./BATCH_GRADE.md) - 批量评分详解
- [API文档](./API.md) - API接口说明
- [开发指南](./DEVELOPMENT.md) - 开发者文档
