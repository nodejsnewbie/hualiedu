# 作业评分系统 - 用户手册

## 目录
- [系统概述](#系统概述)
- [快速入门](#快速入门)
- [课程和班级管理](#课程和班级管理)
- [仓库配置](#仓库配置)
- [作业上传](#作业上传)
- [评分操作](#评分操作)
- [批量操作](#批量操作)
- [常见问题](#常见问题)

## 系统概述

作业评分系统是一个功能完整的教育平台，支持：
- 课程和班级管理
- 两种作业存储方式（Git仓库和文件系统）
- 三种评分方式（字母、文字、百分制）
- AI辅助评分
- 批量评分操作
- 评价缓存和模板

## 快速入门

### 1. 登录系统

访问系统URL并使用您的账号登录。

### 2. 创建课程

1. 进入"课程管理"页面
2. 点击"创建课程"按钮
3. 填写课程信息：
   - 课程名称（如：数据结构）
   - 课程类型（理论课/实验课/实践课/混合课）
   - 课程描述（可选）
4. 点击"保存"

### 3. 创建班级

1. 选择已创建的课程
2. 点击"创建班级"按钮
3. 填写班级信息：
   - 班级名称（如：计算机1班）
   - 学生人数
4. 点击"保存"

### 4. 配置仓库

选择适合您的作业存储方式：

**Git仓库方式**（适合已有Git仓库）：
1. 点击"配置Git仓库"
2. 填写Git信息：
   - 仓库URL
   - 分支名称
   - 认证信息（用户名/密码或Token）
3. 点击"验证连接"
4. 验证成功后保存

**文件系统方式**（适合学生直接上传）：
1. 点击"创建文件系统仓库"
2. 系统自动分配存储空间
3. 学生可通过系统上传作业

### 5. 开始评分

1. 选择仓库和课程
2. 浏览作业文件
3. 点击文件查看内容
4. 选择评分方式并打分
5. 添加评价（实验报告必填）

## 课程和班级管理

### 课程类型说明

| 类型 | 说明 | 默认作业类型 |
|------|------|-------------|
| 理论课 | 纯理论课程 | 普通作业 |
| 实验课 | 纯实验课程 | 实验报告 |
| 实践课 | 实践类课程 | 实验报告 |
| 混合课 | 理论+实验 | 实验报告 |

### 创建课程

**步骤**：
1. 导航到"课程管理" → "创建课程"
2. 填写必填信息：
   - 课程名称：清晰描述课程内容
   - 课程类型：根据实际情况选择
3. 填写可选信息：
   - 课程描述：详细说明课程内容和要求
4. 点击"保存"

**注意事项**：
- 课程名称应该唯一且有意义
- 课程类型影响默认的作业类型判断
- 创建后可以在管理后台修改

### 创建班级

**步骤**：
1. 选择课程
2. 点击"创建班级"
3. 填写班级信息：
   - 班级名称：如"计算机1班"
   - 学生人数：用于统计
4. 点击"保存"

**注意事项**：
- 一个课程可以有多个班级
- 班级名称在同一课程下应该唯一

## 仓库配置

### Git仓库方式

**适用场景**：
- 已有Git仓库管理学生作业
- 学生通过Git提交作业
- 需要版本控制

**配置步骤**：
1. 准备Git仓库信息：
   - 仓库URL（支持HTTPS和SSH）
   - 分支名称（通常是main或master）
   - 认证信息（用户名/密码或Personal Access Token）

2. 在系统中配置：
   - 进入"仓库管理"
   - 选择"Git仓库方式"
   - 填写仓库信息
   - 点击"验证连接"测试
   - 验证成功后保存

**目录结构要求**：
```
仓库根目录/
  ├── 课程名/
  │   ├── 班级名/（可选）
  │   │   ├── 作业批次/
  │   │   │   ├── 学生1.docx
  │   │   │   └── 学生2.docx
```

**常见问题**：
- **连接失败**：检查URL格式和网络连接
- **认证失败**：确认用户名和密码/Token正确
- **找不到分支**：确认分支名称拼写正确

### 文件系统方式

**适用场景**：
- 学生需要通过系统上传作业
- 不使用Git版本控制
- 简单直接的文件管理

**配置步骤**：
1. 进入"仓库管理"
2. 选择"文件系统方式"
3. 填写仓库名称
4. 系统自动分配存储空间
5. 保存配置

**特点**：
- 系统自动创建目录结构
- 学生可直接上传文件
- 支持文件版本管理（覆盖上传）
- 显示空间使用情况

**目录命名规则**：
- 基于教师用户名生成
- 如果重名，自动添加数字后缀（如：username_2）

## 作业上传

### 学生上传作业

**前提条件**：
- 仓库配置为文件系统方式
- 学生已登录系统

**上传步骤**：
1. 进入"作业上传"页面
2. 选择课程和班级
3. 选择作业批次
4. 点击"选择文件"
5. 选择作业文件
6. 点击"上传"

**支持的文件格式**：
- Word文档：.docx, .doc
- Excel表格：.xlsx, .xls
- 文本文件：.txt
- PDF文件：.pdf

**文件大小限制**：
- 单个文件最大50MB

**版本管理**：
- 重复上传会覆盖旧文件
- 系统保留历史版本记录
- 可查看上传历史

### 教师导入作业

**使用管理命令导入**：
```bash
conda run -n py313 python manage.py import_homeworks <仓库路径> <课程名称>
```

**功能**：
- 扫描指定目录
- 自动识别作业批次
- 创建作业记录
- 更新数据库

## 评分操作

### 评分方式

系统支持三种评分方式：

#### 1. 字母等级
- **等级**：A, B, C, D, E
- **适用**：大多数课程
- **特点**：简单直观

#### 2. 文字等级
- **等级**：优秀、良好、中等、及格、不及格
- **适用**：中文环境
- **特点**：符合中文习惯

#### 3. 百分制
- **范围**：0-100分
- **适用**：需要精确评分
- **特点**：精确量化

**评分方式锁定**：
- 首次评分后，班级的评分方式会被锁定
- 确保同一班级评分方式一致
- 如需更改，需在管理后台操作

### 手动评分

**步骤**：
1. 在目录树中选择作业文件
2. 查看文件内容
3. 点击"评分"按钮
4. 选择评分方式
5. 选择或输入评分
6. 添加评价（实验报告必填）
7. 点击"保存"

**实验报告特殊要求**：
- 必须添加评价内容
- 评价不能为空
- 系统会自动验证

**评分写入位置**：
- **实验报告**：写入"教师（签字）"单元格
- **普通作业**：写入文档末尾

### AI辅助评分

**功能**：
- 自动分析作业内容
- 生成评分建议
- 生成评价内容

**使用步骤**：
1. 选择作业文件
2. 点击"AI评分"按钮
3. 等待AI分析（约5-10秒）
4. 查看AI建议的评分和评价
5. 可以修改后再保存
6. 点击"确认"保存

**注意事项**：
- AI评分仅供参考
- 教师可以修改AI建议
- 实验报告会自动生成评价
- 速率限制：每秒最多2个请求

### 评价功能

#### 评价缓存
**功能**：
- 自动保存正在输入的评价
- 防止意外关闭丢失内容
- 每2秒自动保存一次

**使用**：
- 无需手动操作
- 重新打开对话框时自动恢复
- 保存成功后自动清除缓存

#### 评价模板
**功能**：
- 显示常用评价
- 快速填充评价内容
- 基于使用频率排序

**模板类型**：
1. **个人常用评价**：您使用最多的5个评价
2. **系统推荐评价**：全局使用最多的评价

**使用方法**：
1. 打开评价对话框
2. 查看推荐的评价模板
3. 点击模板快速填充
4. 可以编辑后再保存

**模板更新**：
- 每次保存评价时自动统计
- 使用次数自动累加
- 排序自动更新

### 撤销评分

**步骤**：
1. 选择已评分的文件
2. 点击"撤销评分"按钮
3. 确认操作
4. 评分和评价被清除

**注意事项**：
- 撤销后无法恢复
- 格式错误锁定的文件无法撤销
- 需要重新评分

## 批量操作

### 批量评分

**适用场景**：
- 多个学生作业评分相同
- 快速完成评分工作

**步骤**：
1. 点击"批量评分"按钮
2. 选择作业批次目录
3. 选择评分方式
4. 输入统一评分
5. 点击"开始批量评分"
6. 查看进度和结果

**特点**：
- 显示实时进度
- 单个失败不影响整体
- 显示成功和失败统计

### 批量AI评分

**适用场景**：
- 大量作业需要评分
- 希望AI辅助提高效率

**步骤**：
1. 点击"批量AI评分"按钮
2. 选择作业批次目录
3. 点击"开始批量AI评分"
4. 等待处理完成
5. 查看结果摘要

**特点**：
- 自动速率限制（每秒2个请求）
- 显示实时进度
- 失败文件自动跳过
- 显示详细结果

**注意事项**：
- 处理时间较长
- 需要稳定的网络连接
- 建议分批处理大量文件

## 文件导航

### 快速切换文件

**功能**：
- 在同一目录的文件间快速切换
- 显示当前位置（如：3/10）
- 保持评分方式选择

**操作**：
- 点击"上一个"按钮：查看前一个文件
- 点击"下一个"按钮：查看后一个文件
- 第一个文件时"上一个"按钮禁用
- 最后一个文件时"下一个"按钮禁用

### 目录树导航

**功能**：
- 树形结构显示所有目录和文件
- 展开/折叠目录
- 快速定位文件

**操作**：
- 点击目录名展开/折叠
- 点击文件名查看内容
- 使用搜索功能快速查找

## 格式错误处理

### 实验报告格式验证

**验证规则**：
- 实验报告必须包含"教师（签字）"单元格
- 单元格位置和格式必须正确

**格式错误处理**：
1. 系统自动检测格式
2. 如果缺少"教师（签字）"单元格：
   - 评分自动改为D
   - 评价自动设置为"【格式错误-已锁定】请按要求的格式写实验报告，此评分不可修改"
   - 按普通作业方式写入
   - 文件被锁定

**锁定效果**：
- 显示红色警告提示
- 禁用所有评分按钮
- 禁用评价功能
- 无法修改评分

**解锁方法**：
- 学生重新提交正确格式的作业
- 或手动编辑文档删除锁定标记

## 常见问题

### Q1: 如何选择仓库方式？

**A**: 根据您的实际情况选择：
- 如果学生已经使用Git提交作业 → 选择Git仓库方式
- 如果学生需要通过系统上传 → 选择文件系统方式
- 两种方式可以同时配置

### Q2: 实验课程下可以有普通作业吗？

**A**: 可以。作业批次类型优先于课程类型。您可以为每个作业批次单独设置类型。

### Q3: 如何修改已有作业的类型？

**A**: 
1. 在管理后台找到Homework模型
2. 找到对应的作业批次
3. 修改homework_type字段
4. 保存

### Q4: 评分方式可以更改吗？

**A**: 首次评分后，班级的评分方式会被锁定。如需更改：
1. 进入管理后台
2. 找到GradeTypeConfig模型
3. 修改或删除对应记录

### Q5: AI评分不准确怎么办？

**A**: AI评分仅供参考，您可以：
- 修改AI建议的评分
- 修改AI生成的评价
- 完全不使用AI，手动评分

### Q6: 批量评分失败怎么办？

**A**: 
1. 查看错误信息
2. 检查文件格式是否正确
3. 确认文件没有被锁定
4. 单独处理失败的文件

### Q7: 如何查看评分历史？

**A**: 
1. 在管理后台查看Submission模型
2. 可以看到所有评分记录
3. 包括评分时间、评分内容等

### Q8: 文件上传失败怎么办？

**A**: 检查：
- 文件格式是否支持
- 文件大小是否超过50MB
- 网络连接是否正常
- 存储空间是否充足

### Q9: 评价缓存在哪里？

**A**: 评价缓存保存在浏览器的LocalStorage中：
- 每个文件独立缓存
- 7天后自动清理
- 清除浏览器数据会删除缓存

### Q10: 如何导出评分结果？

**A**: 
1. 使用批量登分功能
2. 在管理后台导出数据
3. 使用自定义管理命令

## 技术支持

如果遇到问题：
1. 查看[已知问题](./KNOWN_ISSUES.md)
2. 查看[API文档](./API.md)
3. 查看[设计文档](../.kiro/specs/homework-grading-system/design.md)
4. 联系系统管理员

## 相关文档

- [快速参考](./SUMMARY.md) - 核心概念速查
- [批量登分指南](./BATCH_GRADE.md) - 批量评分详解
- [API文档](./API.md) - API接口说明
- [开发指南](./DEVELOPMENT.md) - 开发者文档
