# 作业评分系统 - 快速参考

## 核心概念

### 作业类型
- **实验报告**：评分写入"教师（签字）"单元格
- **普通作业**：评分写入文档末尾段落

### 判断逻辑
```
1. 作业批次类型（最优先）
   ├─ 有配置 → 使用配置
   └─ 无配置 → 根据课程类型默认
2. 路径解析
3. 关键词匹配
```

## 评分写入流程

### 实验报告
1. 查找"教师（签字）："单元格
2. 清除旧内容（保留签字文本）
3. 写入：评分（第一行）→ 评价（第二行）→ 签字文本（第三行）

### 普通作业
1. 在文档末尾添加"老师评分：X"
2. 在文档末尾添加"教师评价：XXX"

## 统一函数

| 函数 | 功能 | 位置 |
|------|------|------|
| `find_teacher_signature_cell()` | 定位单元格 | views.py:4019 |
| `extract_grade_and_comment_from_cell()` | 提取内容 | views.py:4037 |
| `write_to_teacher_signature_cell()` | 写入内容 | views.py:4115 |
| `is_lab_report_file()` | 判断类型 | views.py:372 |

## 配置建议

### 创建作业批次
```python
Homework.objects.create(
    course=course,
    folder_name="实验1",
    homework_type="lab_report",  # 或 "normal"
    title="数据结构实验1"
)
```

### 目录结构
```
base_dir/
  ├─ 课程名/
  │   ├─ 班级名/（可选）
  │   │   ├─ 作业批次/
  │   │   │   ├─ 学生1.docx
  │   │   │   └─ 学生2.docx
```

## 格式错误处理

### 实验报告格式错误
如果实验报告缺少"教师（签字）"单元格：
1. 评分自动改为 **D**
2. 评价自动设置为：**"【格式错误-已锁定】请按要求的格式写实验报告，此评分不可修改"**
3. 按普通作业方式写入（文档末尾）
4. 文件被锁定，不允许后续修改

### 锁定标记
- 标记：`【格式错误-已锁定】`
- 效果：禁用所有评分和评价功能
- 提示：显示红色警告提示框

## 常见问题

**Q: 实验课程下可以有普通作业吗？**
A: 可以。作业批次类型优先于课程类型。

**Q: 如何修改已有作业的类型？**
A: 在管理后台修改 Homework 的 homework_type 字段。

**Q: 作业批次未配置会怎样？**
A: 系统会根据课程类型自动判断（实验课→实验报告，理论课→普通作业）。

**Q: 实验报告格式错误会怎样？**
A: 自动给D评分并锁定，不允许修改。学生需要使用正确的模板重新提交。

**Q: 如何解锁被锁定的文件？**
A: 需要手动编辑文档，删除"【格式错误-已锁定】"标记。建议让学生重新提交正确格式的作业。

## 详细说明

所有详细内容请参考：**[设计文档](../.kiro/specs/homework-grading-system/design.md)**

这是系统的主文档，包含：
- 评分写入流程
- 作业类型判断逻辑
- 格式错误处理机制
- 统一函数设计
- 数据模型
- 测试策略
