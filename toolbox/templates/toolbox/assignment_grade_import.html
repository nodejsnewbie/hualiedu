{% extends 'base.html' %}

{% block title %}ä½œä¸šæˆç»©å†™å…¥{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <h1 class="mb-3">ğŸ“¥ ä½œä¸šæˆç»©å†™å…¥</h1>
            <p class="text-muted">
                å°† <code>docs/ç¬¬äº”æ¬¡ä½œä¸š.xlsx</code> ä¸­çš„æˆç»©æŒ‰å§“åå†™å…¥ <code>docs/æˆç»©ç™»åˆ†å†Œ.xlsx</code>ï¼ŒåŒä¸€å­¦ç”Ÿåå°†åŒ¹é…åŒä¸€è¡Œã€‚
                ç¬¬ä¸€æ¬¡ä½œä¸šå†™å…¥ç¬¬ 1 åˆ—ï¼ˆç´§éšâ€œå§“åâ€åˆ—ï¼‰ï¼Œç¬¬äº”æ¬¡ä½œä¸šå†™å…¥ç¬¬ 5 åˆ—ï¼Œä»¥æ­¤ç±»æ¨ã€‚
            </p>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">é…ç½®å‚æ•°</h5>
        </div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                <div class="form-group mb-3">
                    <label for="assignment_file" class="form-label">ä½œä¸šæˆç»©æ–‡ä»¶è·¯å¾„</label>
                    <input type="text" class="form-control" id="assignment_file" name="assignment_file"
                           value="{{ form_data.assignment_file }}">
                    <small class="form-text text-muted">é»˜è®¤ï¼šdocs/ç¬¬äº”æ¬¡ä½œä¸š.xlsx</small>
                </div>

                <div class="form-group mb-3">
                    <label for="gradebook_file" class="form-label">æˆç»©ç™»åˆ†å†Œæ–‡ä»¶è·¯å¾„</label>
                    <input type="text" class="form-control" id="gradebook_file" name="gradebook_file"
                           value="{{ form_data.gradebook_file }}">
                    <small class="form-text text-muted">é»˜è®¤ï¼šdocs/æˆç»©ç™»åˆ†å†Œ.xlsx</small>
                </div>

                <div class="form-group mb-3">
                    <label for="assignment_number" class="form-label">ä½œä¸šæ¬¡æ•°ï¼ˆç¬¬å‡ æ¬¡ä½œä¸šï¼‰</label>
                    <input type="number" min="1" class="form-control" id="assignment_number" name="assignment_number"
                           value="{{ form_data.assignment_number }}">
                    <small class="form-text text-muted">ä¾‹å¦‚ï¼š5 è¡¨ç¤ºå†™å…¥ç¬¬ 5 åˆ—ã€‚</small>
                </div>

                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-upload me-2"></i> å¼€å§‹å†™å…¥
                </button>
            </form>
        </div>
    </div>

    {% if result %}
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">æ‰§è¡Œç»“æœ</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <p class="mb-1 text-muted">ç›®æ ‡åˆ—</p>
                    <p class="h5">{{ result.assignment_column_letter }} åˆ—</p>
                </div>
                <div class="col-md-4">
                    <p class="mb-1 text-muted">å·²æ›´æ–°å­¦ç”Ÿ</p>
                    <p class="h5">{{ result.updated_students }} äºº</p>
                </div>
                <div class="col-md-4">
                    <p class="mb-1 text-muted">ç¼ºå¤±åŒ¹é…</p>
                    <p class="h5">
                        ä½œä¸šç¼ºå°‘ {{ result.missing_in_gradebook|length }} äººï¼Œ
                        ç™»åˆ†å†Œç¼ºå°‘ {{ result.missing_in_assignment|length }} äºº
                    </p>
                </div>
            </div>

            {% if result.updates %}
            <div class="table-responsive mt-4">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>å§“å</th>
                            <th>åˆ†æ•°</th>
                            <th>æ‰€åœ¨è¡Œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in result.updates %}
                        <tr>
                            <td>{{ item.name }}</td>
                            <td>{{ item.score }}</td>
                            <td>#{{ item.row }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}

            {% if result.missing_in_gradebook %}
            <div class="mt-4">
                <h6>æˆç»©ç™»åˆ†å†Œä¸­ä¸å­˜åœ¨çš„å­¦ç”Ÿï¼ˆ{{ result.missing_in_gradebook|length }}ï¼‰</h6>
                <p class="text-muted mb-1">è¿™äº›å§“ååœ¨æˆç»©ç™»åˆ†å†Œä¸­æ‰¾ä¸åˆ°ï¼Œè¯·ç¡®è®¤åå•æ˜¯å¦å®Œæ•´ï¼š</p>
                <div>
                    {% for name in result.missing_in_gradebook %}
                        <span class="badge bg-secondary me-2 mb-2">{{ name }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {% if result.missing_in_assignment %}
            <div class="mt-4">
                <h6>ä½œä¸šæˆç»©ä¸­ç¼ºå¤±çš„å­¦ç”Ÿï¼ˆ{{ result.missing_in_assignment|length }}ï¼‰</h6>
                <p class="text-muted mb-1">è¿™äº›å§“ååœ¨ä½œä¸šæ–‡ä»¶ä¸­æœªæ‰¾åˆ°ï¼Œæˆç»©ä¿æŒä¸ºç©ºï¼š</p>
                <div>
                    {% for name in result.missing_in_assignment %}
                        <span class="badge bg-warning text-dark me-2 mb-2">{{ name }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
