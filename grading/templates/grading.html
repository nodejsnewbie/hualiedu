{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<!-- Bootstrap CSS -->
<link rel="stylesheet" href="{% static 'grading/css/bootstrap.min.css' %}">
<!-- jstree CSS -->
<link rel="stylesheet" href="{% static 'grading/css/jstree.min.css' %}">
<!-- Custom CSS -->
<link rel="stylesheet" href="{% static 'grading/css/custom.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- 左侧文件树 -->
        <div class="col-md-3">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">文件列表</h5>
                    {% if config %}
                        <small class="text-muted">仓库路径: {{ config.repo_base_dir }}</small>
                    {% endif %}
                </div>
                <div class="card-body">
                    <div id="grade-tree"></div>
                </div>
            </div>
        </div>

        <!-- 右侧内容区 -->
        <div class="col-md-9">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">评分</h5>
                </div>
                <div class="card-body">
                    <!-- 评分按钮组 -->
                    <div class="btn-group mb-3" role="group" aria-label="评分选项">
                        <button type="button" class="btn btn-outline-primary grade-button" data-grade="A">A</button>
                        <button type="button" class="btn btn-outline-primary grade-button active" data-grade="B">B</button>
                        <button type="button" class="btn btn-outline-primary grade-button" data-grade="C">C</button>
                        <button type="button" class="btn btn-outline-primary grade-button" data-grade="D">D</button>
                        <button type="button" class="btn btn-outline-primary grade-button" data-grade="F">F</button>
                    </div>

                    <!-- 加载指示器 -->
                    <div id="loading" style="display: none;">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">加载中...</span>
                        </div>
                    </div>

                    <!-- 文件内容显示区域 -->
                    <div id="file-content" class="mt-3">
                        {% if error %}
                            <div class="alert alert-danger">
                                {{ error }}
                            </div>
                        {% else %}
                            <div class="alert alert-info">
                                请从左侧选择要评分的文件
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- jQuery -->
<script src="{% static 'grading/js/jquery.min.js' %}"></script>
<!-- Bootstrap Bundle with Popper -->
<script src="{% static 'grading/js/bootstrap.bundle.min.js' %}"></script>
<!-- jstree JavaScript -->
<script src="{% static 'grading/js/jstree.min.js' %}"></script>
<!-- 自定义脚本 -->
<script src="{% static 'grading/js/grading.js' %}"></script>

<!-- 初始化数据 -->
<script>
    // 将初始数据传递给 JavaScript
    window.initialTreeData = JSON.parse('{{ initial_tree_data|escapejs }}');
    console.log('Initial tree data in template:', window.initialTreeData);
    
    // 设置 CSRF token
    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
            }
        }
    });
</script>
{% endblock %} 